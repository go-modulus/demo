version: '3.3'

volumes:
  postgres:

services:
  demo:
    build: .
    ports:
      - 8888:8888
    volumes:
      - .:/go/src/app
    restart: unless-stopped

  postgres:
    image: postgres:${POSTGRESQL_VERSION}-alpine
    volumes:
      - postgres:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: modulus
      POSTGRES_PASSWORD: secret
      POSTGRES_DB: demo
    ports:
      - 5432:5432
    restart: unless-stopped

#  elasticsearch:
#    container_name: temporal-elasticsearch
#    environment:
#      - cluster.routing.allocation.disk.threshold_enabled=true
#      - cluster.routing.allocation.disk.watermark.low=512mb
#      - cluster.routing.allocation.disk.watermark.high=256mb
#      - cluster.routing.allocation.disk.watermark.flood_stage=128mb
#      - discovery.type=single-node
#      - ES_JAVA_OPTS=-Xms256m -Xmx256m
#      - xpack.security.enabled=false
#    image: elasticsearch:${ELASTICSEARCH_VERSION}
#    expose:
#      - 9200
#
#  temporal:
#      depends_on:
#        - postgres
#        - elasticsearch
#      environment:
#        - DB=postgresql
#        - DB_PORT=5432
#        - POSTGRES_USER=modulus
#        - POSTGRES_PWD=secret
#        - POSTGRES_SEEDS=postgres
#        - DYNAMIC_CONFIG_FILE_PATH=config/dynamicconfig/development-sql.yaml
#        - ENABLE_ES=true
#        - ES_SEEDS=elasticsearch
#        - ES_VERSION=v7
#      image: temporalio/auto-setup:${TEMPORAL_VERSION}
#      ports:
#        - 7233:7233
#      labels:
#        kompose.volume.type: configMap
#      volumes:
#        - ./temporal/dynamicconfig:/etc/temporal/config/dynamicconfig
#
#  temporal-admin-tools:
#      depends_on:
#        - temporal
#      environment:
#        - TEMPORAL_CLI_ADDRESS=temporal:7233
#      image: temporalio/admin-tools:${TEMPORAL_VERSION}
#      stdin_open: true
#      tty: true
#
#  temporal-ui:
#      depends_on:
#        - temporal
#      environment:
#        - TEMPORAL_ADDRESS=temporal:7233
#        - TEMPORAL_CORS_ORIGINS=http://localhost:3000
#      image: temporalio/ui:${TEMPORAL_UI_VERSION}
#      ports:
#        - 8080:8080